{% extends "layouts/public.html" %}

{# =========================================================================
   ERROR 403 PAGE - Página de error de acceso prohibido
   Ecosistema de Emprendimiento
   ========================================================================= #}

{% block title %}Acceso Prohibido (403) - EcoEmprendimiento{% endblock %}

{% block description %}No tienes permisos para acceder a esta página. Verifica tus credenciales o contacta al administrador.{% endblock %}

{% block keywords %}error 403, acceso prohibido, permisos, autenticación, emprendimiento{% endblock %}

{% block robots %}noindex, nofollow{% endblock %}

{% block og_title %}Acceso Prohibido - EcoEmprendimiento{% endblock %}
{% block og_description %}No tienes permisos para acceder a esta página. Te ayudamos a encontrar lo que buscas.{% endblock %}

{% block extra_css %}
{{ super() }}
<style>
  /* ========================================================================= 
     ERROR 403 PAGE STYLES
     ========================================================================= */
  
  /* Variables específicas para página de error */
  :root {
    --error-primary: #ef4444;
    --error-secondary: #f97316;
    --error-accent: #8b5cf6;
    --error-warning: #f59e0b;
    --error-bg: linear-gradient(135deg, #fef2f2 0%, #fff7ed 50%, #faf5ff 100%);
    --error-shadow: 0 20px 25px -5px rgba(239, 68, 68, 0.1), 0 10px 10px -5px rgba(239, 68, 68, 0.04);
  }
  
  /* Layout principal del error */
  .error-page {
    min-height: 100vh;
    background: var(--error-bg);
    display: flex;
    align-items: center;
    padding: 2rem 0;
    position: relative;
    overflow: hidden;
  }
  
  .error-page::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(239, 68, 68, 0.05) 0%, transparent 70%);
    animation: float 20s ease-in-out infinite;
  }
  
  .error-page::after {
    content: '';
    position: absolute;
    bottom: -30%;
    right: -30%;
    width: 60%;
    height: 60%;
    background: radial-gradient(circle, rgba(139, 92, 246, 0.08) 0%, transparent 70%);
    animation: float 25s ease-in-out infinite reverse;
  }
  
  /* Contenedor principal */
  .error-container {
    position: relative;
    z-index: 2;
    text-align: center;
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  
  /* Ilustración del error */
  .error-illustration {
    margin-bottom: 3rem;
    position: relative;
  }
  
  .error-code {
    font-size: 8rem;
    font-weight: 900;
    font-family: var(--font-heading);
    background: linear-gradient(135deg, var(--error-primary) 0%, var(--error-secondary) 50%, var(--error-accent) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1;
    margin-bottom: 1rem;
    animation: pulse 3s ease-in-out infinite;
    text-shadow: 0 4px 8px rgba(239, 68, 68, 0.2);
  }
  
  .error-icon {
    font-size: 4rem;
    color: var(--error-primary);
    margin-bottom: 2rem;
    animation: bounce 2s infinite;
  }
  
  /* Contenido del error */
  .error-content h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 1rem;
    animation: fadeInUp 1s ease-out;
  }
  
  .error-content .error-subtitle {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--error-primary);
    margin-bottom: 1.5rem;
    animation: fadeInUp 1s ease-out 0.2s both;
  }
  
  .error-content .error-description {
    font-size: 1.125rem;
    color: var(--gray-600);
    line-height: 1.6;
    margin-bottom: 3rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    animation: fadeInUp 1s ease-out 0.4s both;
  }
  
  /* Detalles del error */
  .error-details {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 3rem;
    box-shadow: var(--shadow-lg);
    border-left: 4px solid var(--error-primary);
    animation: fadeInUp 1s ease-out 0.6s both;
  }
  
  .error-details h3 {
    color: var(--error-primary);
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .error-details h3 i {
    margin-right: 0.5rem;
  }
  
  .error-reasons {
    list-style: none;
    padding: 0;
    text-align: left;
    max-width: 500px;
    margin: 0 auto;
  }
  
  .error-reasons li {
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    align-items: center;
    color: var(--gray-700);
  }
  
  .error-reasons li:last-child {
    border-bottom: none;
  }
  
  .error-reasons li i {
    color: var(--error-secondary);
    margin-right: 0.75rem;
    font-size: 1.125rem;
  }
  
  /* Acciones disponibles */
  .error-actions {
    animation: fadeInUp 1s ease-out 0.8s both;
  }
  
  .action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
    margin-bottom: 3rem;
  }
  
  .btn-error-primary {
    background: linear-gradient(135deg, var(--error-primary) 0%, var(--error-secondary) 100%);
    border: none;
    color: white;
    padding: 0.875rem 2rem;
    font-weight: 600;
    border-radius: 0.75rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.1);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
  }
  
  .btn-error-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--error-shadow);
    color: white;
    text-decoration: none;
  }
  
  .btn-error-secondary {
    background: white;
    border: 2px solid var(--error-primary);
    color: var(--error-primary);
    padding: 0.875rem 2rem;
    font-weight: 600;
    border-radius: 0.75rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
  }
  
  .btn-error-secondary:hover {
    background: var(--error-primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--error-shadow);
    text-decoration: none;
  }
  
  .btn i {
    margin-right: 0.5rem;
  }
  
  /* Información de ayuda */
  .help-section {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: var(--shadow-md);
    margin-bottom: 3rem;
    animation: fadeInUp 1s ease-out 1s both;
  }
  
  .help-title {
    color: var(--gray-900);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .help-title i {
    color: var(--info-color);
    margin-right: 0.75rem;
    font-size: 1.75rem;
  }
  
  .help-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }
  
  .help-item {
    text-align: center;
    padding: 1.5rem;
    border-radius: 0.75rem;
    background: var(--gray-50);
    transition: all 0.3s ease;
  }
  
  .help-item:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    background: white;
  }
  
  .help-item i {
    font-size: 2.5rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
    display: block;
  }
  
  .help-item h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 0.75rem;
  }
  
  .help-item p {
    color: var(--gray-600);
    font-size: 0.9rem;
    line-height: 1.5;
    margin-bottom: 1rem;
  }
  
  .help-item a {
    color: var(--primary-color);
    font-weight: 500;
    text-decoration: none;
    font-size: 0.9rem;
  }
  
  .help-item a:hover {
    text-decoration: underline;
  }
  
  /* Información de contacto */
  .contact-section {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
    color: white;
    border-radius: 1rem;
    padding: 2rem;
    text-align: center;
    animation: fadeInUp 1s ease-out 1.2s both;
  }
  
  .contact-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }
  
  .contact-description {
    margin-bottom: 2rem;
    opacity: 0.9;
  }
  
  .contact-methods {
    display: flex;
    justify-content: center;
    gap: 2rem;
    flex-wrap: wrap;
  }
  
  .contact-method {
    display: flex;
    align-items: center;
    color: white;
    text-decoration: none;
    transition: all 0.3s ease;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    background: rgba(255, 255, 255, 0.1);
  }
  
  .contact-method:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
    color: white;
    text-decoration: none;
  }
  
  .contact-method i {
    margin-right: 0.75rem;
    font-size: 1.25rem;
  }
  
  /* Navegación de páginas relacionadas */
  .related-pages {
    animation: fadeInUp 1s ease-out 1.4s both;
  }
  
  .related-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 2rem;
    text-align: center;
  }
  
  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }
  
  .related-link {
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: 0.75rem;
    padding: 1.5rem 1rem;
    text-decoration: none;
    color: var(--gray-700);
    transition: all 0.3s ease;
    text-align: center;
  }
  
  .related-link:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    text-decoration: none;
  }
  
  .related-link i {
    font-size: 2rem;
    margin-bottom: 0.75rem;
    display: block;
  }
  
  .related-link span {
    font-weight: 500;
  }
  
  /* Animaciones */
  @keyframes float {
    0%, 100% {
      transform: translateY(0px) rotate(0deg);
    }
    50% {
      transform: translateY(-20px) rotate(5deg);
    }
  }
  
  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }
  
  @keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
      transform: translate3d(0, 0, 0);
    }
    40%, 43% {
      transform: translate3d(0, -8px, 0);
    }
    70% {
      transform: translate3d(0, -4px, 0);
    }
    90% {
      transform: translate3d(0, -2px, 0);
    }
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .error-code {
      font-size: 6rem;
    }
    
    .error-content h1 {
      font-size: 2rem;
    }
    
    .error-content .error-subtitle {
      font-size: 1.25rem;
    }
    
    .error-details,
    .help-section,
    .contact-section {
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .action-buttons {
      flex-direction: column;
      align-items: center;
    }
    
    .btn-error-primary,
    .btn-error-secondary {
      width: 100%;
      max-width: 300px;
      justify-content: center;
    }
    
    .help-grid {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    
    .contact-methods {
      flex-direction: column;
      gap: 1rem;
    }
    
    .related-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }
  }
  
  @media (max-width: 576px) {
    .error-code {
      font-size: 4.5rem;
    }
    
    .error-content h1 {
      font-size: 1.75rem;
    }
    
    .related-grid {
      grid-template-columns: 1fr;
    }
    
    .error-page {
      padding: 1rem 0;
    }
  }
  
  /* Modo oscuro */
  @media (prefers-color-scheme: dark) {
    :root {
      --error-bg: linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%);
    }
    
    .error-details,
    .help-section {
      background: #1f2937;
      color: #e5e7eb;
    }
    
    .help-item {
      background: #374151;
      color: #e5e7eb;
    }
    
    .help-item:hover {
      background: #4b5563;
    }
    
    .related-link {
      background: #1f2937;
      border-color: #4b5563;
      color: #e5e7eb;
    }
    
    .related-link:hover {
      border-color: var(--primary-light);
      color: var(--primary-light);
    }
  }
  
  /* Impresión */
  @media print {
    .error-page::before,
    .error-page::after {
      display: none;
    }
    
    .action-buttons,
    .contact-section {
      display: none;
    }
    
    .error-page {
      background: white;
    }
    
    .error-code {
      color: #000;
    }
  }
</style>
{% endblock %}

{% block hero %}
<!-- No hero para página de error -->
{% endblock %}

{% block content %}
<div class="error-page">
  <div class="error-container">
    <!-- Ilustración del Error -->
    <div class="error-illustration">
      <div class="error-icon">
        <i class="fas fa-lock" aria-hidden="true"></i>
      </div>
      <div class="error-code" aria-label="Error 403">403</div>
    </div>
    
    <!-- Contenido Principal del Error -->
    <div class="error-content">
      <h1>Acceso Prohibido</h1>
      <p class="error-subtitle">No tienes permisos para acceder a esta página</p>
      <p class="error-description">
        Lo sentimos, pero no tienes los permisos necesarios para ver este contenido. 
        Esto puede deberse a varias razones que explicamos a continuación.
      </p>
    </div>
    
    <!-- Detalles del Error -->
    <div class="error-details">
      <h3>
        <i class="fas fa-info-circle" aria-hidden="true"></i>
        ¿Por qué está ocurriendo esto?
      </h3>
      <ul class="error-reasons">
        <li>
          <i class="fas fa-user-slash" aria-hidden="true"></i>
          Tu cuenta no tiene los permisos necesarios para esta sección
        </li>
        <li>
          <i class="fas fa-clock" aria-hidden="true"></i>
          Tu sesión puede haber expirado y necesitas iniciar sesión nuevamente
        </li>
        <li>
          <i class="fas fa-shield-alt" aria-hidden="true"></i>
          El contenido está restringido a ciertos roles de usuario
        </li>
        <li>
          <i class="fas fa-cog" aria-hidden="true"></i>
          Puede haber un problema temporal con los permisos del sistema
        </li>
        <li>
          <i class="fas fa-link" aria-hidden="true"></i>
          La URL puede ser incorrecta o el recurso ya no existe
        </li>
      </ul>
    </div>
    
    <!-- Acciones Disponibles -->
    <div class="error-actions">
      <div class="action-buttons">
        {% if current_user.is_authenticated %}
          <a href="{{ url_for('main.dashboard') }}" class="btn-error-primary">
            <i class="fas fa-tachometer-alt" aria-hidden="true"></i>
            Ir al Dashboard
          </a>
          <a href="javascript:history.back()" class="btn-error-secondary">
            <i class="fas fa-arrow-left" aria-hidden="true"></i>
            Volver Atrás
          </a>
        {% else %}
          <a href="{{ url_for('auth.login') }}" class="btn-error-primary">
            <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
            Iniciar Sesión
          </a>
          <a href="{{ url_for('auth.register') }}" class="btn-error-secondary">
            <i class="fas fa-user-plus" aria-hidden="true"></i>
            Registrarse
          </a>
        {% endif %}
      </div>
    </div>
    
    <!-- Sección de Ayuda -->
    <div class="help-section">
      <h2 class="help-title">
        <i class="fas fa-question-circle" aria-hidden="true"></i>
        ¿Necesitas ayuda?
      </h2>
      <p>Si crees que deberías tener acceso a esta página, aquí tienes algunas opciones:</p>
      
      <div class="help-grid">
        <div class="help-item">
          <i class="fas fa-redo-alt" aria-hidden="true"></i>
          <h4>Reinicia tu Sesión</h4>
          <p>Cierra sesión y vuelve a iniciarla para actualizar tus permisos</p>
          {% if current_user.is_authenticated %}
            <a href="{{ url_for('auth.logout') }}">Cerrar Sesión</a>
          {% else %}
            <a href="{{ url_for('auth.login') }}">Iniciar Sesión</a>
          {% endif %}
        </div>
        
        <div class="help-item">
          <i class="fas fa-user-cog" aria-hidden="true"></i>
          <h4>Revisa tu Perfil</h4>
          <p>Verifica que tu cuenta esté correctamente configurada y verificada</p>
          {% if current_user.is_authenticated %}
            <a href="{{ url_for('main.profile') }}">Ver Perfil</a>
          {% else %}
            <a href="{{ url_for('public.about') }}">Más Información</a>
          {% endif %}
        </div>
        
        <div class="help-item">
          <i class="fas fa-users-cog" aria-hidden="true"></i>
          <h4>Contacta al Administrador</h4>
          <p>Si necesitas permisos especiales, contacta al equipo de administración</p>
          <a href="{{ url_for('public.contact') }}">Contactar</a>
        </div>
        
        <div class="help-item">
          <i class="fas fa-book" aria-hidden="true"></i>
          <h4>Centro de Ayuda</h4>
          <p>Consulta nuestra documentación sobre roles y permisos</p>
          <a href="{{ url_for('public.help') }}">Ver Ayuda</a>
        </div>
      </div>
    </div>
    
    <!-- Información de Contacto -->
    <div class="contact-section">
      <h3 class="contact-title">¿Necesitas Asistencia Inmediata?</h3>
      <p class="contact-description">
        Nuestro equipo de soporte está aquí para ayudarte a resolver cualquier problema de acceso.
      </p>
      <div class="contact-methods">
        <a href="mailto:soporte@ecoemprendimiento.com" class="contact-method">
          <i class="fas fa-envelope" aria-hidden="true"></i>
          <span>soporte@ecoemprendimiento.com</span>
        </a>
        <a href="tel:+34900123456" class="contact-method">
          <i class="fas fa-phone" aria-hidden="true"></i>
          <span>+34 900 123 456</span>
        </a>
        <a href="{{ url_for('public.contact') }}" class="contact-method">
          <i class="fas fa-comments" aria-hidden="true"></i>
          <span>Chat en Vivo</span>
        </a>
      </div>
    </div>
    
    <!-- Páginas Relacionadas -->
    <div class="related-pages">
      <h3 class="related-title">Páginas que Puedes Visitar</h3>
      <div class="related-grid">
        <a href="{{ url_for('main.index') }}" class="related-link">
          <i class="fas fa-home" aria-hidden="true"></i>
          <span>Inicio</span>
        </a>
        
        <a href="{{ url_for('public.about') }}" class="related-link">
          <i class="fas fa-info-circle" aria-hidden="true"></i>
          <span>Nosotros</span>
        </a>
        
        <a href="{{ url_for('public.programs') }}" class="related-link">
          <i class="fas fa-graduation-cap" aria-hidden="true"></i>
          <span>Programas</span>
        </a>
        
        <a href="{{ url_for('public.entrepreneurs') }}" class="related-link">
          <i class="fas fa-users" aria-hidden="true"></i>
          <span>Emprendedores</span>
        </a>
        
        <a href="{{ url_for('public.success_stories') }}" class="related-link">
          <i class="fas fa-star" aria-hidden="true"></i>
          <span>Casos de Éxito</span>
        </a>
        
        <a href="{{ url_for('public.contact') }}" class="related-link">
          <i class="fas fa-envelope" aria-hidden="true"></i>
          <span>Contacto</span>
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
{{ super() }}
<script>
// =========================================================================
// ERROR 403 PAGE JAVASCRIPT
// =========================================================================

document.addEventListener('DOMContentLoaded', function() {
  // Log del error para analytics
  if (typeof gtag !== 'undefined') {
    gtag('event', 'page_view', {
      'page_title': 'Error 403 - Acceso Prohibido',
      'page_location': window.location.href,
      'custom_parameter': 'error_page'
    });
  }
  
  // Reporte del error para monitoring
  if (typeof fetch !== 'undefined') {
    fetch('/api/v1/errors/report', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        error_type: '403',
        url: window.location.href,
        referrer: document.referrer,
        user_agent: navigator.userAgent,
        timestamp: new Date().toISOString()
      })
    }).catch(error => {
      console.log('Error reporting failed:', error);
    });
  }
  
  // Añadir efectos de partículas (opcional)
  createFloatingElements();
  
  // Auto-focus en el primer botón de acción
  const firstActionButton = document.querySelector('.btn-error-primary');
  if (firstActionButton) {
    firstActionButton.focus();
  }
  
  // Mostrar información adicional basada en el contexto
  showContextualHelp();
  
  // Configurar shortcuts de teclado
  setupKeyboardShortcuts();
});

// Crear elementos flotantes decorativos
function createFloatingElements() {
  const container = document.querySelector('.error-page');
  if (!container) return;
  
  // Crear elementos flotantes sutiles
  for (let i = 0; i < 5; i++) {
    const element = document.createElement('div');
    element.style.cssText = `
      position: absolute;
      width: ${Math.random() * 20 + 10}px;
      height: ${Math.random() * 20 + 10}px;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 50%;
      pointer-events: none;
      animation: float ${Math.random() * 10 + 10}s infinite ease-in-out;
      top: ${Math.random() * 100}%;
      left: ${Math.random() * 100}%;
      animation-delay: ${Math.random() * 5}s;
    `;
    container.appendChild(element);
  }
}

// Mostrar ayuda contextual
function showContextualHelp() {
  const urlParams = new URLSearchParams(window.location.search);
  const reason = urlParams.get('reason');
  const from = urlParams.get('from');
  
  if (reason || from) {
    const helpSection = document.querySelector('.error-details');
    if (helpSection) {
      const contextInfo = document.createElement('div');
      contextInfo.className = 'alert alert-info mt-3';
      contextInfo.innerHTML = `
        <i class="fas fa-info-circle me-2"></i>
        <strong>Información adicional:</strong> 
        ${getContextualMessage(reason, from)}
      `;
      helpSection.appendChild(contextInfo);
    }
  }
}

// Obtener mensaje contextual
function getContextualMessage(reason, from) {
  if (reason === 'role_required') {
    return 'Esta página requiere un rol específico de usuario.';
  } else if (reason === 'subscription_required') {
    return 'Esta funcionalidad requiere una suscripción activa.';
  } else if (reason === 'verification_required') {
    return 'Tu cuenta necesita ser verificada para acceder a este contenido.';
  } else if (from) {
    return `Intento de acceso desde: ${decodeURIComponent(from)}`;
  }
  return 'Acceso denegado por políticas de seguridad.';
}

// Configurar shortcuts de teclado
function setupKeyboardShortcuts() {
  document.addEventListener('keydown', function(e) {
    // Alt + H = Ir al inicio
    if (e.altKey && e.key === 'h') {
      e.preventDefault();
      window.location.href = '{{ url_for("main.index") }}';
    }
    
    // Alt + L = Ir al login (si no está autenticado)
    {% if not current_user.is_authenticated %}
    if (e.altKey && e.key === 'l') {
      e.preventDefault();
      window.location.href = '{{ url_for("auth.login") }}';
    }
    {% endif %}
    
    // Alt + D = Ir al dashboard (si está autenticado)
    {% if current_user.is_authenticated %}
    if (e.altKey && e.key === 'd') {
      e.preventDefault();
      window.location.href = '{{ url_for("main.dashboard") }}';
    }
    {% endif %}
    
    // Alt + C = Ir a contacto
    if (e.altKey && e.key === 'c') {
      e.preventDefault();
      window.location.href = '{{ url_for("public.contact") }}';
    }
    
    // Escape = Volver atrás
    if (e.key === 'Escape') {
      e.preventDefault();
      history.back();
    }
  });
}

// Función para reintentar acceso
function retryAccess() {
  // Mostrar loader
  const retryBtn = document.querySelector('[onclick="retryAccess()"]');
  if (retryBtn) {
    const originalText = retryBtn.innerHTML;
    retryBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Reintentando...';
    retryBtn.disabled = true;
    
    // Simular reintento
    setTimeout(() => {
      window.location.reload();
    }, 1500);
  }
}

// Función para reportar problema
function reportProblem() {
  const modal = document.createElement('div');
  modal.className = 'modal fade';
  modal.innerHTML = `
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Reportar Problema de Acceso</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="problemReportForm">
            <div class="mb-3">
              <label for="problemDescription" class="form-label">Describe el problema:</label>
              <textarea class="form-control" id="problemDescription" rows="4" required 
                        placeholder="Por favor describe qué estabas intentando hacer cuando ocurrió este error..."></textarea>
            </div>
            <div class="mb-3">
              <label for="expectedAccess" class="form-label">¿Por qué crees que deberías tener acceso?</label>
              <textarea class="form-control" id="expectedAccess" rows="3"
                        placeholder="Opcional: explica por qué consideras que deberías poder acceder a esta página..."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" onclick="submitProblemReport()">Enviar Reporte</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  const modalInstance = new bootstrap.Modal(modal);
  modalInstance.show();
  
  // Limpiar modal al cerrar
  modal.addEventListener('hidden.bs.modal', function() {
    document.body.removeChild(modal);
  });
}

// Enviar reporte de problema
function submitProblemReport() {
  const form = document.getElementById('problemReportForm');
  const description = document.getElementById('problemDescription').value;
  const expectedAccess = document.getElementById('expectedAccess').value;
  
  if (!description.trim()) {
    alert('Por favor describe el problema.');
    return;
  }
  
  const reportData = {
    error_type: '403',
    url: window.location.href,
    description: description,
    expected_access: expectedAccess,
    user_agent: navigator.userAgent,
    timestamp: new Date().toISOString()
  };
  
  fetch('/api/v1/errors/report-problem', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(reportData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('Reporte enviado exitosamente. Te contactaremos pronto.');
      bootstrap.Modal.getInstance(document.querySelector('.modal')).hide();
    } else {
      alert('Error al enviar el reporte. Por favor intenta más tarde.');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error al enviar el reporte. Por favor intenta más tarde.');
  });
}

// Mostrar sugerencias adicionales después de un tiempo
setTimeout(function() {
  const suggestion = document.createElement('div');
  suggestion.className = 'alert alert-light border-primary mt-4 animate__animated animate__fadeInUp';
  suggestion.innerHTML = `
    <div class="d-flex align-items-center">
      <i class="fas fa-lightbulb text-warning me-3 fs-4"></i>
      <div>
        <strong>💡 Sugerencia:</strong> Si eres un emprendedor nuevo, 
        <a href="{{ url_for('public.programs') }}" class="alert-link">explora nuestros programas</a> 
        para encontrar el camino adecuado para ti.
      </div>
    </div>
  `;
  
  const container = document.querySelector('.error-container');
  if (container) {
    container.appendChild(suggestion);
  }
}, 10000); // Mostrar después de 10 segundos

// Accessibility improvements
document.addEventListener('DOMContentLoaded', function() {
  // Anunciar el error a screen readers
  const announcement = document.createElement('div');
  announcement.setAttribute('aria-live', 'polite');
  announcement.setAttribute('aria-atomic', 'true');
  announcement.className = 'sr-only';
  announcement.textContent = 'Error 403: Acceso prohibido. No tienes permisos para ver esta página.';
  document.body.appendChild(announcement);
  
  // Mejorar navegación con teclado
  const focusableElements = document.querySelectorAll('a, button, [tabindex]:not([tabindex="-1"])');
  focusableElements.forEach((el, index) => {
    el.addEventListener('keydown', function(e) {
      if (e.key === 'Tab') {
        // Lógica adicional de navegación si es necesaria
      }
    });
  });
});
</script>
{% endblock %}