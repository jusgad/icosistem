<!DOCTYPE html>
<html lang="{{ get_locale()|string|replace('_', '-') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO Meta Tags -->
    <title>{% block title %}{{ config.get('APP_NAME', 'Icosistem') }}{% endblock %}</title>
    <meta name="description" content="{% block description %}Plataforma integral para el ecosistema de emprendimiento. Conectamos emprendedores, mentores y aliados estratégicos para impulsar la innovación y el crecimiento empresarial.{% endblock %}">
    <meta name="keywords" content="{% block keywords %}emprendimiento, startup, incubadora, aceleradora, mentoria, innovacion, emprendedores, financiamiento, networking{% endblock %}">
    <meta name="author" content="{{ config.get('APP_NAME', 'Icosistem') }}">
    <meta name="robots" content="{% block robots %}index, follow{% endblock %}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ self.description() }}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ url_for('static', filename='img/og-image.jpg', _external=True) }}{% endblock %}">
    <meta property="og:site_name" content="{{ config.get('APP_NAME', 'Icosistem') }}">
    <meta property="og:locale" content="{{ get_locale()|string|replace('_', '-') }}">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ request.url }}">
    <meta property="twitter:title" content="{% block twitter_title %}{{ self.og_title() }}{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}{{ self.og_description() }}{% endblock %}">
    <meta property="twitter:image" content="{% block twitter_image %}{{ self.og_image() }}{% endblock %}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ request.url }}">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #7c3aed;
            --dark-color: #111827;
            --light-color: #f9fafb;
            --font-heading: 'Poppins', sans-serif;
            --font-body: 'Inter', sans-serif;
        }
        body {
            font-family: var(--font-body);
            background-color: var(--light-color);
            color: #374151;
        }
        .navbar.fixed-top {
            transition: background-color 0.3s ease-in-out;
        }
        .navbar-dark .navbar-nav .nav-link {
            color: rgba(255, 255, 255, 0.8);
        }
        .navbar-dark .navbar-nav .nav-link:hover {
            color: white;
        }
        .footer {
            background-color: var(--dark-color);
            color: #d1d5db;
        }
        .footer a {
            color: #9ca3af;
            text-decoration: none;
        }
        .footer a:hover {
            color: white;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background: rgba(0,0,0,0.1); backdrop-filter: blur(10px);">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{{ url_for('main.index') }}">
                <i class="fas fa-rocket me-2"></i>
                {{ config.get('APP_NAME', 'Icosistem') }}
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#inicio">{{ _('Inicio') }}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#servicios">{{ _('Servicios') }}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#programas">{{ _('Programas') }}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#testimonios">{{ _('Testimonios') }}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contacto">{{ _('Contacto') }}</a>
                    </li>
                </ul>
                <div class="navbar-nav">
                    {% if current_user and current_user.is_authenticated %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="{{ current_user.avatar_url or url_for('static', filename='dist/img/default-avatar.jpg') }}" alt="Avatar" class="rounded-circle me-2" width="30" height="30">
                            {{ current_user.username or current_user.email }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" href="{{ url_for('client_dashboard.index') }}"><i class="fas fa-tachometer-alt me-2"></i>{{ _('Dashboard') }}</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('profile.edit') }}"><i class="fas fa-user me-2"></i>{{ _('Perfil') }}</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt me-2"></i>{{ _('Cerrar Sesión') }}</a></li>
                        </ul>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('auth.login') }}">{{ _('Iniciar Sesión') }}</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-light ms-2" href="{{ url_for('auth.register') }}">{{ _('Registrarse') }}</a>
                    </li>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="{% block main_class %}{% endblock %}">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="container mt-5 pt-5">
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5 class="text-white">{{ config.get('APP_NAME', 'Icosistem') }}</h5>
                    <p class="text-muted">{{ _('Impulsando la próxima generación de innovadores.') }}</p>
                </div>
                <div class="col-lg-2 col-md-4 col-6 mb-4 mb-lg-0">
                    <h6 class="text-white">{{ _('Navegación') }}</h6>
                    <ul class="list-unstyled">
                        <li><a href="#inicio">{{ _('Inicio') }}</a></li>
                        <li><a href="#servicios">{{ _('Servicios') }}</a></li>
                        <li><a href="#programas">{{ _('Programas') }}</a></li>
                        <li><a href="#contacto">{{ _('Contacto') }}</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-4 col-6 mb-4 mb-lg-0">
                    <h6 class="text-white">{{ _('Legal') }}</h6>
                    <ul class="list-unstyled">
                        <li><a href="#">{{ _('Términos') }}</a></li>
                        <li><a href="#">{{ _('Privacidad') }}</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-4">
                    <h6 class="text-white">{{ _('Síguenos') }}</h6>
                    <div>
                        <a href="#" class="me-3"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="me-3"><i class="fab fa-facebook-f fa-lg"></i></a>
                        <a href="#" class="me-3"><i class="fab fa-linkedin-in fa-lg"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center text-muted">
                &copy; {{ "now"|strftime("%Y") }} {{ config.get('APP_NAME', 'Icosistem') }}. {{ _('Todos los derechos reservados.') }}
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const target = document.querySelector(targetId);
                if (target) {
                    // Adjust for fixed navbar height if necessary
                    const navbarHeight = document.querySelector('.navbar').offsetHeight;
                    const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - navbarHeight;
                    
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });

                    // Update URL hash without jumping
                    if(history.pushState) {
                        history.pushState(null, null, targetId);
                    } else {
                        location.hash = targetId;
                    }
                }
            });
        });

        // Intersection Observer for fade-in animations
        const fadeElements = document.querySelectorAll('.fade-in');
        const fadeObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    fadeObserver.unobserve(entry.target);
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });
        fadeElements.forEach(el => fadeObserver.observe(el));

        // Counter animation for stats
        const countElements = document.querySelectorAll('.stat-number');
        const countObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const target = parseInt(entry.target.getAttribute('data-target'));
                    animateCounter(entry.target, target);
                    countObserver.unobserve(entry.target);
                }
            });
        }, { threshold: 0.8 });
        countElements.forEach(el => countObserver.observe(el));

        function animateCounter(element, target) {
            let current = 0;
            const duration = 2000; // 2 seconds
            const stepTime = Math.abs(Math.floor(duration / target));
            const timer = setInterval(() => {
                current += 1;
                element.textContent = current;
                if (current == target) {
                    clearInterval(timer);
                }
            }, stepTime);
        }

        // Navbar background change on scroll
        const navbar = document.querySelector('.navbar.fixed-top');
        if (navbar) {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    navbar.style.background = 'rgba(17, 24, 39, 0.9)'; // dark-color with opacity
                } else {
                    navbar.style.background = 'rgba(0,0,0,0.1)';
                }
            });
        }

        // Add loading animation to buttons on click
        document.querySelectorAll('.btn-gradient').forEach(btn => {
            btn.addEventListener('click', function(e) {
                if (this.href && !this.href.includes('#')) {
                    const originalText = this.innerHTML;
                    this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> {{ _("Cargando...") }}';
                    this.disabled = true;

                    // Fallback to re-enable button
                    setTimeout(() => {
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }, 5000);
                }
            });
        });

        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });
    </script>
    {% block page_js %}{% endblock %}
</body>
</html>