<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Tiempo - Panel de Aliados</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        :root {
            --primary-color: #1a237e;
            --secondary-color: #3f51b5;
            --accent-color: #00bcd4;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --info-color: #2196f3;
            --light-bg: #f8f9fa;
            --dark-text: #263238;
            --border-radius: 15px;
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-success: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --gradient-warning: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            color: var(--dark-text);
        }

        .hours-header {
            background: var(--gradient-primary);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }

        .hours-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="time-pattern" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="8" fill="none" stroke="white" stroke-width="0.5" opacity="0.1"/><line x1="10" y1="10" x2="10" y2="5" stroke="white" stroke-width="1" opacity="0.1"/><line x1="10" y1="10" x2="14" y2="10" stroke="white" stroke-width="0.5" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23time-pattern)"/></svg>');
        }

        .hours-header .container {
            position: relative;
            z-index: 1;
        }

        .hours-stats {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 2rem;
            color: var(--dark-text);
            box-shadow: var(--card-shadow);
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #666;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.5rem;
        }

        .stat-change {
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        .stat-change.neutral {
            color: var(--warning-color);
        }

        .dashboard-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .dashboard-section:hover {
            box-shadow: var(--hover-shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark-text);
            margin: 0;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 0.75rem;
            color: var(--accent-color);
        }

        .time-tracker {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }

        .time-tracker::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-accent);
        }

        .tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .current-activity {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .activity-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--success-color);
            animation: pulse 2s infinite;
        }

        .activity-indicator.paused {
            background: var(--warning-color);
            animation: none;
        }

        .activity-indicator.stopped {
            background: var(--danger-color);
            animation: none;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .time-display {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-color);
            font-family: 'Courier New', monospace;
        }

        .tracker-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .activity-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .activity-card.meeting::before { background: #4facfe; }
        .activity-card.mentorship::before { background: #84fab0; }
        .activity-card.due-diligence::before { background: #f093fb; }
        .activity-card.admin::before { background: #ff9800; }
        .activity-card.research::before { background: #e74c3c; }

        .activity-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--hover-shadow);
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .activity-info h6 {
            margin: 0;
            font-weight: 700;
            color: var(--dark-text);
        }

        .activity-info .company {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .activity-duration {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .activity-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #666;
        }

        .availability-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .day-column {
            background: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .day-header {
            font-weight: 700;
            color: var(--dark-text);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .time-slot {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .time-slot.available {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: var(--success-color);
        }

        .time-slot.busy {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: var(--danger-color);
            cursor: not-allowed;
        }

        .time-slot.blocked {
            background: rgba(96, 125, 139, 0.1);
            border: 1px solid rgba(96, 125, 139, 0.3);
            color: #607d8b;
        }

        .time-slot:hover:not(.busy) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .productivity-chart {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .efficiency-meter {
            text-align: center;
            padding: 2rem;
        }

        .efficiency-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(
                var(--success-color) 0deg 252deg,
                #e9ecef 252deg 360deg
            );
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            position: relative;
        }

        .efficiency-circle::before {
            content: '';
            position: absolute;
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
        }

        .efficiency-value {
            position: relative;
            z-index: 1;
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-text);
        }

        .rate-card {
            background: var(--gradient-warning);
            color: var(--dark-text);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .rate-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .rate-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .earning-projection {
            background: var(--gradient-success);
            color: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
        }

        .nav-tabs-custom {
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 2rem;
        }

        .nav-tabs-custom .nav-link {
            border: none;
            border-radius: 0;
            color: #666;
            font-weight: 600;
            padding: 1rem 2rem;
            transition: all 0.3s ease;
        }

        .nav-tabs-custom .nav-link:hover {
            color: var(--accent-color);
            border-color: transparent;
            background: none;
        }

        .nav-tabs-custom .nav-link.active {
            color: var(--accent-color);
            background: none;
            border-bottom: 3px solid var(--accent-color);
        }

        .btn-custom {
            border-radius: 25px;
            padding: 0.6rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.9rem;
        }

        .btn-primary-custom {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-accent-custom {
            background: var(--gradient-accent);
            color: white;
        }

        .btn-accent-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
        }

        .btn-success-custom {
            background: var(--gradient-success);
            color: white;
        }

        .btn-success-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(132, 250, 176, 0.4);
        }

        .btn-outline-custom {
            border: 2px solid var(--secondary-color);
            color: var(--secondary-color);
            background: transparent;
        }

        .btn-outline-custom:hover {
            background: var(--secondary-color);
            color: white;
            transform: translateY(-2px);
        }

        .time-entry {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent-color);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .entry-title {
            font-weight: 600;
            color: var(--dark-text);
        }

        .entry-duration {
            font-weight: 700;
            color: var(--accent-color);
        }

        .entry-details {
            font-size: 0.85rem;
            color: #666;
        }

        .invoice-item {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .invoice-item:hover {
            border-color: var(--accent-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .invoice-status {
            display: inline-flex;
            align-items: center;
            font-size: 0.8rem;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-weight: 600;
        }

        .status-paid {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning-color);
        }

        .status-overdue {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quick-stat {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .quick-stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin: 0 auto 1rem;
        }

        .quick-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-text);
            margin-bottom: 0.5rem;
        }

        .quick-stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 1200px) {
            .availability-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .hours-header {
                padding: 1rem 0;
            }
            
            .dashboard-section {
                padding: 1rem;
            }
            
            .availability-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .time-display {
                font-size: 2rem;
            }
            
            .tracker-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .nav-tabs-custom .nav-link {
                padding: 0.75rem 1rem;
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
        }

        .play-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-success);
            border: none;
            color: white;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(132, 250, 176, 0.4);
        }

        .play-btn.pause {
            background: var(--gradient-warning);
        }

        .play-btn.stop {
            background: var(--gradient-secondary);
        }

        .project-selector {
            max-width: 300px;
        }

        .billable-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-switch .form-check-input {
            width: 3rem;
            height: 1.5rem;
        }

        .form-switch .form-check-input:checked {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .weekly-hours {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
        }

        .hours-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .hours-fill {
            height: 100%;
            background: var(--gradient-accent);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .day-hours {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .reports-filter {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay d-none" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Header -->
    <div class="hours-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="mb-3"><i class="fas fa-clock me-3"></i>Gestión de Tiempo</h1>
                    <p class="mb-0 lead">Optimiza tu tiempo y maximiza el impacto en tu portfolio de inversiones</p>
                </div>
                <div class="col-lg-4">
                    <div class="hours-stats">
                        <div class="row">
                            <div class="col-4">
                                <div class="stat-item">
                                    <div class="stat-number" id="weeklyHours">32.5</div>
                                    <div class="stat-label">Horas Semana</div>
                                    <div class="stat-change positive">+4.2h vs anterior</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-item">
                                    <div class="stat-number" id="billableHours">28.0</div>
                                    <div class="stat-label">Facturables</div>
                                    <div class="stat-change positive">86% ratio</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-item">
                                    <div class="stat-number" id="efficiency">94%</div>
                                    <div class="stat-label">Eficiencia</div>
                                    <div class="stat-change positive">+3% vs mes</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Time Tracker Activo -->
        <div class="time-tracker">
            <div class="tracker-header">
                <div class="current-activity">
                    <div class="activity-indicator" id="activityIndicator"></div>
                    <div>
                        <h5 class="mb-0" id="currentActivityName">No hay actividad activa</h5>
                        <small class="text-muted" id="currentActivityClient">Selecciona un proyecto para comenzar</small>
                    </div>
                </div>
                <div class="time-display" id="timeDisplay">00:00:00</div>
            </div>
            
            <div class="row align-items-center">
                <div class="col-lg-4">
                    <div class="project-selector">
                        <select class="form-select" id="projectSelect">
                            <option value="">Seleccionar proyecto...</option>
                            <option value="techstart-mentoring">TechStart AI - Mentoría</option>
                            <option value="finflow-dd">FinFlow - Due Diligence</option>
                            <option value="ecomart-meeting">EcoMart - Reunión Estratégica</option>
                            <option value="portfolio-review">Portfolio Review</option>
                            <option value="admin-tasks">Tareas Administrativas</option>
                        </select>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="timer-controls">
                        <button class="play-btn" id="playBtn" onclick="toggleTimer()">
                            <i class="fas fa-play" id="playIcon"></i>
                        </button>
                        <button class="btn btn-outline-custom" onclick="resetTimer()">
                            <i class="fas fa-stop me-2"></i>Detener
                        </button>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="billable-toggle">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="billableToggle" checked>
                            <label class="form-check-label" for="billableToggle">
                                <strong>Facturable</strong>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navegación por Pestañas -->
        <ul class="nav nav-tabs nav-tabs-custom" id="hoursTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="today-tab" data-bs-toggle="tab" data-bs-target="#today" type="button" role="tab">
                    <i class="fas fa-calendar-day me-2"></i>Hoy
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="week-tab" data-bs-toggle="tab" data-bs-target="#week" type="button" role="tab">
                    <i class="fas fa-calendar-week me-2"></i>Esta Semana
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="availability-tab" data-bs-toggle="tab" data-bs-target="#availability" type="button" role="tab">
                    <i class="fas fa-calendar-check me-2"></i>Disponibilidad
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
                    <i class="fas fa-chart-bar me-2"></i>Análisis
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="billing-tab" data-bs-toggle="tab" data-bs-target="#billing" type="button" role="tab">
                    <i class="fas fa-receipt me-2"></i>Facturación
                </button>
            </li>
        </ul>

        <!-- Contenido de las Pestañas -->
        <div class="tab-content" id="hoursTabContent">
            <!-- Hoy -->
            <div class="tab-pane fade show active" id="today" role="tabpanel">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-list"></i>Actividades de Hoy
                                </h3>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-custom btn-sm" onclick="addManualEntry()">
                                        <i class="fas fa-plus me-2"></i>Entrada Manual
                                    </button>
                                    <button class="btn btn-accent-custom btn-sm" onclick="exportToday()">
                                        <i class="fas fa-download me-2"></i>Exportar
                                    </button>
                                </div>
                            </div>
                            
                            <div id="todayActivities">
                                <!-- Las actividades se cargarán aquí dinámicamente -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Resumen del Día -->
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h5 class="section-title">
                                    <i class="fas fa-chart-pie"></i>Resumen del Día
                                </h5>
                            </div>
                            
                            <canvas id="todayDistributionChart" width="300" height="200"></canvas>
                            
                            <div class="mt-4">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Total trabajado:</span>
                                    <strong id="todayTotal">7h 45m</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Horas facturables:</span>
                                    <strong class="text-success" id="todayBillable">6h 30m</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Eficiencia:</span>
                                    <strong class="text-info" id="todayEfficiency">84%</strong>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Objetivos del Día -->
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h5 class="section-title">
                                    <i class="fas fa-target"></i>Objetivos del Día
                                </h5>
                            </div>
                            
                            <div class="day-hours">
                                <span>Meta diaria: 8 horas</span>
                                <span class="text-success">97%</span>
                            </div>
                            <div class="hours-bar">
                                <div class="hours-fill" style="width: 97%"></div>
                            </div>
                            
                            <div class="mt-3">
                                <small class="text-muted">Faltan 15 minutos para completar tu meta diaria</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Esta Semana -->
            <div class="tab-pane fade" id="week" role="tabpanel">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-calendar-week"></i>Resumen Semanal
                                </h3>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary active" onclick="changeWeekView('current')">Esta Semana</button>
                                    <button type="button" class="btn btn-outline-primary" onclick="changeWeekView('previous')">Semana Anterior</button>
                                    <button type="button" class="btn btn-outline-primary" onclick="changeWeekView('next')">Próxima Semana</button>
                                </div>
                            </div>
                            
                            <div class="weekly-hours">
                                <div class="day-hours">
                                    <span><strong>Lunes</strong></span>
                                    <span>8h 30m</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 106%"></div>
                                </div>
                                
                                <div class="day-hours">
                                    <span><strong>Martes</strong></span>
                                    <span>7h 15m</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 91%"></div>
                                </div>
                                
                                <div class="day-hours">
                                    <span><strong>Miércoles</strong></span>
                                    <span>6h 45m</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 84%"></div>
                                </div>
                                
                                <div class="day-hours">
                                    <span><strong>Jueves</strong></span>
                                    <span>8h 0m</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 100%"></div>
                                </div>
                                
                                <div class="day-hours">
                                    <span><strong>Viernes</strong></span>
                                    <span>2h 0m</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 25%"></div>
                                </div>
                                
                                <div class="day-hours">
                                    <span><strong>Sábado</strong></span>
                                    <span>0h 0m</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 0%"></div>
                                </div>
                                
                                <div class="day-hours">
                                    <span><strong>Domingo</strong></span>
                                    <span>0h 0m</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-chart-line"></i>Tendencia Semanal
                                </h3>
                            </div>
                            
                            <canvas id="weeklyTrendChart" height="250"></canvas>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Stats Rápidas -->
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <div class="quick-stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="quick-stat-value">32.5h</div>
                                <div class="quick-stat-label">Total Semana</div>
                            </div>
                            
                            <div class="quick-stat">
                                <div class="quick-stat-icon" style="background: var(--gradient-success);">
                                    <i class="fas fa-euro-sign"></i>
                                </div>
                                <div class="quick-stat-value">28h</div>
                                <div class="quick-stat-label">Facturables</div>
                            </div>
                            
                            <div class="quick-stat">
                                <div class="quick-stat-icon" style="background: var(--gradient-warning);">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="quick-stat-value">86%</div>
                                <div class="quick-stat-label">Ratio Facturable</div>
                            </div>
                            
                            <div class="quick-stat">
                                <div class="quick-stat-icon" style="background: var(--gradient-secondary);">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="quick-stat-value">94%</div>
                                <div class="quick-stat-label">Eficiencia</div>
                            </div>
                        </div>
                        
                        <!-- Distribución por Proyecto -->
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h5 class="section-title">
                                    <i class="fas fa-chart-pie"></i>Por Proyecto
                                </h5>
                            </div>
                            
                            <canvas id="weeklyProjectChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Disponibilidad -->
            <div class="tab-pane fade" id="availability" role="tabpanel">
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            <i class="fas fa-calendar-check"></i>Configurar Disponibilidad
                        </h3>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-custom btn-sm" onclick="setDefaultHours()">
                                <i class="fas fa-clock me-2"></i>Horario Estándar
                            </button>
                            <button class="btn btn-accent-custom btn-sm" onclick="saveAvailability()">
                                <i class="fas fa-save me-2"></i>Guardar Cambios
                            </button>
                        </div>
                    </div>
                    
                    <div class="availability-grid" id="availabilityGrid">
                        <!-- Los días se cargarán dinámicamente -->
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-6">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h5 class="section-title">
                                    <i class="fas fa-cog"></i>Configuración de Horarios
                                </h5>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Horario de trabajo por defecto</label>
                                <div class="row">
                                    <div class="col-6">
                                        <input type="time" class="form-control" id="defaultStartTime" value="09:00">
                                    </div>
                                    <div class="col-6">
                                        <input type="time" class="form-control" id="defaultEndTime" value="17:00">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Duración de slots (minutos)</label>
                                <select class="form-select" id="slotDuration">
                                    <option value="15">15 minutos</option>
                                    <option value="30" selected>30 minutos</option>
                                    <option value="60">60 minutos</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Tiempo entre reuniones</label>
                                <select class="form-select" id="bufferTime">
                                    <option value="0">Sin buffer</option>
                                    <option value="15" selected>15 minutos</option>
                                    <option value="30">30 minutos</option>
                                </select>
                            </div>
                            
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="weekendsAvailable">
                                <label class="form-check-label" for="weekendsAvailable">
                                    Disponible fines de semana
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h5 class="section-title">
                                    <i class="fas fa-ban"></i>Bloqueos Automáticos
                                </h5>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="lunchBreak" checked>
                                    <label class="form-check-label" for="lunchBreak">
                                        Bloquear hora de almuerzo (12:00 - 13:00)
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="earlyMorning">
                                    <label class="form-check-label" for="earlyMorning">
                                        Bloquear antes de las 8:00 AM
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="lateEvening" checked>
                                    <label class="form-check-label" for="lateEvening">
                                        Bloquear después de las 18:00 PM
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Zona horaria</label>
                                <select class="form-select" id="timezone">
                                    <option value="Europe/Madrid" selected>Madrid (UTC+1)</option>
                                    <option value="America/New_York">Nueva York (UTC-5)</option>
                                    <option value="America/Los_Angeles">Los Ángeles (UTC-8)</option>
                                    <option value="Europe/London">Londres (UTC+0)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Análisis -->
            <div class="tab-pane fade" id="analytics" role="tabpanel">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-chart-bar"></i>Análisis de Productividad
                                </h3>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary active" onclick="changeAnalyticsPeriod('month')">Este Mes</button>
                                    <button type="button" class="btn btn-outline-primary" onclick="changeAnalyticsPeriod('quarter')">Trimestre</button>
                                    <button type="button" class="btn btn-outline-primary" onclick="changeAnalyticsPeriod('year')">Año</button>
                                </div>
                            </div>
                            
                            <canvas id="productivityChart" height="300"></canvas>
                        </div>
                        
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-clock"></i>Distribución Horaria
                                </h3>
                            </div>
                            
                            <canvas id="hourlyDistributionChart" height="250"></canvas>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Medidor de Eficiencia -->
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h5 class="section-title">
                                    <i class="fas fa-tachometer-alt"></i>Eficiencia Global
                                </h5>
                            </div>
                            
                            <div class="efficiency-meter">
                                <div class="efficiency-circle">
                                    <div class="efficiency-value">94%</div>
                                </div>
                                <h6>Excelente</h6>
                                <p class="text-muted small">
                                    Tu eficiencia está por encima del promedio del sector (78%)
                                </p>
                            </div>
                        </div>
                        
                        <!-- Top Proyectos -->
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h5 class="section-title">
                                    <i class="fas fa-star"></i>Proyectos Principales
                                </h5>
                            </div>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="small">TechStart AI</span>
                                    <span class="small fw-bold">28%</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 28%"></div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="small">FinFlow Solutions</span>
                                    <span class="small fw-bold">22%</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 22%"></div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="small">EcoMart</span>
                                    <span class="small fw-bold">18%</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 18%"></div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="small">Portfolio Review</span>
                                    <span class="small fw-bold">15%</span>
                                </div>
                                <div class="hours-bar">
                                    <div class="hours-fill" style="width: 15%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Facturación -->
            <div class="tab-pane fade" id="billing" role="tabpanel">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-receipt"></i>Gestión de Facturación
                                </h3>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-custom btn-sm" onclick="generateInvoice()">
                                        <i class="fas fa-plus me-2"></i>Nueva Factura
                                    </button>
                                    <button class="btn btn-accent-custom btn-sm" onclick="exportBilling()">
                                        <i class="fas fa-download me-2"></i>Exportar
                                    </button>
                                </div>
                            </div>
                            
                            <div class="reports-filter">
                                <div class="row align-items-center">
                                    <div class="col-md-3">
                                        <select class="form-select form-select-sm">
                                            <option value="all">Todas las facturas</option>
                                            <option value="paid">Pagadas</option>
                                            <option value="pending">Pendientes</option>
                                            <option value="overdue">Vencidas</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="month" class="form-control form-control-sm" value="2025-06">
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-select form-select-sm">
                                            <option value="">Todos los clientes</option>
                                            <option value="techstart">TechStart AI</option>
                                            <option value="finflow">FinFlow Solutions</option>
                                            <option value="ecomart">EcoMart</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-outline-primary btn-sm w-100">Filtrar</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="invoicesList">
                                <!-- Las facturas se cargarán aquí -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Tarifas -->
                        <div class="rate-card">
                            <div class="rate-value">€250</div>
                            <div class="rate-label">Tarifa por hora estándar</div>
                        </div>
                        
                        <div class="rate-card" style="background: var(--gradient-success); color: white;">
                            <div class="rate-value">€350</div>
                            <div class="rate-label">Tarifa Due Diligence</div>
                        </div>
                        
                        <!-- Proyección de Ingresos -->
                        <div class="earning-projection">
                            <h5>Proyección Mensual</h5>
                            <div class="rate-value">€7,850</div>
                            <div class="rate-label">Basado en horas actuales</div>
                        </div>
                        
                        <!-- Resumen Financiero -->
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h5 class="section-title">
                                    <i class="fas fa-chart-pie"></i>Resumen del Mes
                                </h5>
                            </div>
                            
                            <div class="d-flex justify-content-between mb-2">
                                <span>Total facturado:</span>
                                <strong>€8,750</strong>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Cobrado:</span>
                                <strong class="text-success">€6,250</strong>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Pendiente:</span>
                                <strong class="text-warning">€2,500</strong>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Tasa de cobro:</span>
                                <strong class="text-info">71%</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Entrada Manual -->
    <div class="modal fade" id="manualEntryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Entrada Manual</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="manualEntryForm">
                        <div class="mb-3">
                            <label for="entryProject" class="form-label">Proyecto</label>
                            <select class="form-select" id="entryProject" required>
                                <option value="">Seleccionar proyecto...</option>
                                <option value="techstart-mentoring">TechStart AI - Mentoría</option>
                                <option value="finflow-dd">FinFlow - Due Diligence</option>
                                <option value="ecomart-meeting">EcoMart - Reunión</option>
                                <option value="admin-tasks">Tareas Administrativas</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="entryDate" class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="entryDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="entryDuration" class="form-label">Duración (horas)</label>
                                <input type="number" class="form-control" id="entryDuration" step="0.25" min="0.25" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="entryStartTime" class="form-label">Hora inicio</label>
                                <input type="time" class="form-control" id="entryStartTime">
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch mt-4">
                                    <input class="form-check-input" type="checkbox" id="entryBillable" checked>
                                    <label class="form-check-label" for="entryBillable">
                                        Facturable
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="entryDescription" class="form-label">Descripción</label>
                            <textarea class="form-control" id="entryDescription" rows="3" placeholder="Describe las actividades realizadas..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary-custom" onclick="saveManualEntry()">
                        <i class="fas fa-save me-2"></i>Guardar Entrada
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
        // Estado global de la aplicación
        let isTimerRunning = false;
        let isPaused = false;
        let startTime = null;
        let pausedTime = 0;
        let currentProject = null;
        let timeEntries = [];
        let timerInterval = null;

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            loadTimeEntries();
            loadTodayActivities();
            loadInvoices();
            generateAvailabilityGrid();
            initializeCharts();
            updateStats();
            
            // Establecer fecha de hoy en el modal
            document.getElementById('entryDate').value = new Date().toISOString().split('T')[0];
        });

        // Funciones del timer
        function toggleTimer() {
            const playBtn = document.getElementById('playBtn');
            const playIcon = document.getElementById('playIcon');
            const projectSelect = document.getElementById('projectSelect');
            const indicator = document.getElementById('activityIndicator');

            if (!isTimerRunning) {
                // Validar que se haya seleccionado un proyecto
                if (!projectSelect.value) {
                    alert('Por favor selecciona un proyecto antes de iniciar el timer.');
                    return;
                }

                // Iniciar timer
                currentProject = projectSelect.value;
                startTime = Date.now() - pausedTime;
                isTimerRunning = true;
                isPaused = false;

                playIcon.className = 'fas fa-pause';
                playBtn.className = 'play-btn pause';
                indicator.className = 'activity-indicator';
                
                updateCurrentActivity();
                timerInterval = setInterval(updateTimer, 1000);

            } else if (!isPaused) {
                // Pausar timer
                isPaused = true;
                pausedTime = Date.now() - startTime;
                
                playIcon.className = 'fas fa-play';
                playBtn.className = 'play-btn';
                indicator.className = 'activity-indicator paused';
                
                clearInterval(timerInterval);

            } else {
                // Reanudar timer
                isPaused = false;
                startTime = Date.now() - pausedTime;
                
                playIcon.className = 'fas fa-pause';
                playBtn.className = 'play-btn pause';
                indicator.className = 'activity-indicator';
                
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        function resetTimer() {
            if (isTimerRunning && (Date.now() - startTime - pausedTime) > 60000) { // Más de 1 minuto
                const duration = (Date.now() - startTime - pausedTime) / 1000 / 3600; // Convertir a horas
                const billable = document.getElementById('billableToggle').checked;
                
                // Guardar entrada de tiempo
                const entry = {
                    id: Date.now(),
                    project: currentProject,
                    projectName: getProjectName(currentProject),
                    date: new Date().toISOString().split('T')[0],
                    startTime: new Date(startTime).toTimeString().slice(0, 5),
                    duration: duration,
                    billable: billable,
                    description: `Trabajo en ${getProjectName(currentProject)}`
                };
                
                timeEntries.push(entry);
                loadTodayActivities();
                updateStats();
            }

            // Reset timer
            isTimerRunning = false;
            isPaused = false;
            startTime = null;
            pausedTime = 0;
            currentProject = null;

            document.getElementById('playIcon').className = 'fas fa-play';
            document.getElementById('playBtn').className = 'play-btn';
            document.getElementById('activityIndicator').className = 'activity-indicator stopped';
            document.getElementById('timeDisplay').textContent = '00:00:00';
            document.getElementById('currentActivityName').textContent = 'No hay actividad activa';
            document.getElementById('currentActivityClient').textContent = 'Selecciona un proyecto para comenzar';
            document.getElementById('projectSelect').value = '';

            clearInterval(timerInterval);
        }

        function updateTimer() {
            if (isTimerRunning && !isPaused) {
                const elapsed = Date.now() - startTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);

                document.getElementById('timeDisplay').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function updateCurrentActivity() {
            const projectName = getProjectName(currentProject);
            const clientName = getClientName(currentProject);
            
            document.getElementById('currentActivityName').textContent = projectName;
            document.getElementById('currentActivityClient').textContent = clientName;
        }

        // Cargar entradas de tiempo
        function loadTimeEntries() {
            // Datos de ejemplo
            timeEntries = [
                {
                    id: 1,
                    project: 'techstart-mentoring',
                    projectName: 'TechStart AI - Mentoría',
                    date: '2025-06-15',
                    startTime: '09:00',
                    duration: 2.5,
                    billable: true,
                    description: 'Sesión de mentoría estratégica sobre expansión Series B'
                },
                {
                    id: 2,
                    project: 'finflow-dd',
                    projectName: 'FinFlow - Due Diligence',
                    date: '2025-06-15',
                    startTime: '11:30',
                    duration: 3.0,
                    billable: true,
                    description: 'Análisis técnico y revisión de arquitectura'
                },
                {
                    id: 3,
                    project: 'ecomart-meeting',
                    projectName: 'EcoMart - Reunión',
                    date: '2025-06-15',
                    startTime: '14:30',
                    duration: 1.5,
                    billable: true,
                    description: 'Reunión estratégica sobre expansión internacional'
                },
                {
                    id: 4,
                    project: 'admin-tasks',
                    projectName: 'Tareas Administrativas',
                    date: '2025-06-15',
                    startTime: '16:00',
                    duration: 0.75,
                    billable: false,
                    description: 'Gestión de emails y tareas administrativas'
                }
            ];
        }

        // Cargar actividades de hoy
        function loadTodayActivities() {
            const today = new Date().toISOString().split('T')[0];
            const todayEntries = timeEntries.filter(entry => entry.date === today);

            const container = document.getElementById('todayActivities');
            container.innerHTML = '';

            if (todayEntries.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No hay actividades registradas para hoy</p>';
                return;
            }

            todayEntries.forEach(entry => {
                const activityCard = createActivityCard(entry);
                container.appendChild(activityCard);
            });

            updateTodayStats(todayEntries);
        }

        // Crear card de actividad
        function createActivityCard(entry) {
            const card = document.createElement('div');
            card.className = `activity-card ${getProjectType(entry.project)}`;

            const endTime = calculateEndTime(entry.startTime, entry.duration);

            card.innerHTML = `
                <div class="activity-header">
                    <div class="activity-info">
                        <h6>${entry.projectName}</h6>
                        <div class="company">${getClientName(entry.project)}</div>
                    </div>
                    <div class="activity-duration">${formatDuration(entry.duration)}</div>
                </div>
                <div class="activity-details">
                    <div>
                        <i class="fas fa-clock me-1"></i>
                        ${entry.startTime} - ${endTime}
                    </div>
                    <div>
                        ${entry.billable ? 
                            '<span class="badge bg-success">Facturable</span>' : 
                            '<span class="badge bg-secondary">No facturable</span>'
                        }
                    </div>
                </div>
                ${entry.description ? `<div class="mt-2"><small class="text-muted">${entry.description}</small></div>` : ''}
                <div class="mt-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="editEntry(${entry.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-danger btn-sm ms-1" onclick="deleteEntry(${entry.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            return card;
        }

        // Actualizar estadísticas de hoy
        function updateTodayStats(entries) {
            const totalHours = entries.reduce((sum, entry) => sum + entry.duration, 0);
            const billableHours = entries.filter(e => e.billable).reduce((sum, entry) => sum + entry.duration, 0);
            const efficiency = entries.length > 0 ? (billableHours / totalHours * 100) : 0;

            document.getElementById('todayTotal').textContent = formatDuration(totalHours);
            document.getElementById('todayBillable').textContent = formatDuration(billableHours);
            document.getElementById('todayEfficiency').textContent = Math.round(efficiency) + '%';
        }

        // Generar grid de disponibilidad
        function generateAvailabilityGrid() {
            const grid = document.getElementById('availabilityGrid');
            const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
            const timeSlots = [];

            // Generar slots de 9:00 a 18:00 cada 30 minutos
            for (let hour = 9; hour < 18; hour++) {
                timeSlots.push(`${hour.toString().padStart(2, '0')}:00`);
                timeSlots.push(`${hour.toString().padStart(2, '0')}:30`);
            }

            grid.innerHTML = '';

            days.forEach((day, dayIndex) => {
                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column';

                dayColumn.innerHTML = `
                    <div class="day-header">${day}</div>
                    ${timeSlots.map(time => {
                        const status = getTimeSlotStatus(dayIndex, time);
                        return `<div class="time-slot ${status}" onclick="toggleTimeSlot(${dayIndex}, '${time}')">${time}</div>`;
                    }).join('')}
                `;

                grid.appendChild(dayColumn);
            });
        }

        function getTimeSlotStatus(dayIndex, time) {
            // Lógica para determinar el estado del slot
            // En un caso real, esto vendría de la base de datos
            if (dayIndex >= 5) return 'blocked'; // Fines de semana bloqueados
            if (time >= '12:00' && time <= '13:00') return 'busy'; // Hora de almuerzo
            return 'available';
        }

        function toggleTimeSlot(dayIndex, time) {
            // Implementar toggle de disponibilidad
            console.log(`Toggle slot: Day ${dayIndex}, Time ${time}`);
        }

        // Cargar facturas
        function loadInvoices() {
            const invoices = [
                {
                    id: 'INV-2025-006',
                    client: 'TechStart AI',
                    amount: 2250,
                    hours: 9,
                    date: '2025-06-01',
                    dueDate: '2025-06-30',
                    status: 'paid'
                },
                {
                    id: 'INV-2025-007',
                    client: 'FinFlow Solutions',
                    amount: 3150,
                    hours: 9,
                    date: '2025-06-01',
                    dueDate: '2025-06-30',
                    status: 'pending'
                },
                {
                    id: 'INV-2025-008',
                    client: 'EcoMart',
                    amount: 1875,
                    hours: 7.5,
                    date: '2025-06-01',
                    dueDate: '2025-05-30',
                    status: 'overdue'
                }
            ];

            const container = document.getElementById('invoicesList');
            container.innerHTML = '';

            invoices.forEach(invoice => {
                const invoiceCard = document.createElement('div');
                invoiceCard.className = 'invoice-item';

                invoiceCard.innerHTML = `
                    <div class="invoice-header">
                        <div>
                            <h6 class="mb-1">${invoice.id}</h6>
                            <small class="text-muted">${invoice.client}</small>
                        </div>
                        <span class="invoice-status status-${invoice.status}">
                            ${getStatusText(invoice.status)}
                        </span>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <small class="text-muted">Monto</small>
                            <div class="fw-bold">€${invoice.amount}</div>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Horas</small>
                            <div class="fw-bold">${invoice.hours}h</div>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Fecha</small>
                            <div class="fw-bold">${formatDate(invoice.date)}</div>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Vencimiento</small>
                            <div class="fw-bold ${invoice.status === 'overdue' ? 'text-danger' : ''}">${formatDate(invoice.dueDate)}</div>
                        </div>
                    </div>
                    <div class="mt-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="viewInvoice('${invoice.id}')">
                            <i class="fas fa-eye me-1"></i>Ver
                        </button>
                        <button class="btn btn-outline-success btn-sm ms-1" onclick="downloadInvoice('${invoice.id}')">
                            <i class="fas fa-download me-1"></i>Descargar
                        </button>
                        ${invoice.status === 'pending' ? `
                            <button class="btn btn-success btn-sm ms-1" onclick="markAsPaid('${invoice.id}')">
                                <i class="fas fa-check me-1"></i>Marcar Pagado
                            </button>
                        ` : ''}
                    </div>
                `;

                container.appendChild(invoiceCard);
            });
        }

        // Inicializar gráficos
        function initializeCharts() {
            initTodayDistributionChart();
            initWeeklyTrendChart();
            initWeeklyProjectChart();
            initProductivityChart();
            initHourlyDistributionChart();
        }

        // Gráfico distribución de hoy
        function initTodayDistributionChart() {
            const ctx = document.getElementById('todayDistributionChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Mentoría', 'Due Diligence', 'Reuniones', 'Admin'],
                    datasets: [{
                        data: [32, 39, 19, 10],
                        backgroundColor: [
                            '#84fab0',
                            '#f093fb',
                            '#4facfe',
                            '#ff9800'
                        ],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 10,
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        // Gráfico tendencia semanal
        function initWeeklyTrendChart() {
            const ctx = document.getElementById('weeklyTrendChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
                    datasets: [{
                        label: 'Horas trabajadas',
                        data: [8.5, 7.2, 6.8, 8.0, 2.0, 0, 0],
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Horas facturables',
                        data: [7.5, 6.5, 6.0, 7.5, 1.5, 0, 0],
                        borderColor: '#84fab0',
                        backgroundColor: 'rgba(132, 250, 176, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        }

        // Gráfico proyectos semanales
        function initWeeklyProjectChart() {
            const ctx = document.getElementById('weeklyProjectChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['TechStart AI', 'FinFlow', 'EcoMart', 'Admin', 'Otros'],
                    datasets: [{
                        data: [28, 22, 18, 15, 17],
                        backgroundColor: [
                            '#4facfe',
                            '#f093fb',
                            '#84fab0',
                            '#ff9800',
                            '#e74c3c'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 10,
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });
        }

        // Gráfico productividad
        function initProductivityChart() {
            const ctx = document.getElementById('productivityChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
                    datasets: [{
                        label: 'Horas trabajadas',
                        data: [35, 38, 32, 40],
                        backgroundColor: '#4facfe'
                    }, {
                        label: 'Horas facturables',
                        data: [30, 33, 28, 35],
                        backgroundColor: '#84fab0'
                    }, {
                        label: 'Eficiencia (%)',
                        data: [86, 87, 88, 88],
                        backgroundColor: '#f093fb',
                        type: 'line',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'left'
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        // Gráfico distribución horaria
        function initHourlyDistributionChart() {
            const ctx = document.getElementById('hourlyDistributionChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['9-10', '10-11', '11-12', '13-14', '14-15', '15-16', '16-17', '17-18'],
                    datasets: [{
                        label: 'Productividad por hora',
                        data: [85, 92, 95, 78, 88, 90, 85, 75],
                        backgroundColor: '#4facfe'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Funciones de gestión
        function addManualEntry() {
            const modal = new bootstrap.Modal(document.getElementById('manualEntryModal'));
            modal.show();
        }

        function saveManualEntry() {
            const form = document.getElementById('manualEntryForm');
            const formData = new FormData(form);

            const entry = {
                id: Date.now(),
                project: formData.get('entryProject'),
                projectName: getProjectName(formData.get('entryProject')),
                date: formData.get('entryDate'),
                startTime: formData.get('entryStartTime'),
                duration: parseFloat(formData.get('entryDuration')),
                billable: document.getElementById('entryBillable').checked,
                description: formData.get('entryDescription')
            };

            timeEntries.push(entry);
            loadTodayActivities();
            updateStats();

            const modal = bootstrap.Modal.getInstance(document.getElementById('manualEntryModal'));
            modal.hide();

            form.reset();
            showNotification('Entrada agregada correctamente', 'success');
        }

        function editEntry(entryId) {
            const entry = timeEntries.find(e => e.id === entryId);
            showNotification(`Editando entrada: ${entry.projectName}`, 'info');
        }

        function deleteEntry(entryId) {
            if (confirm('¿Estás seguro de que quieres eliminar esta entrada?')) {
                timeEntries = timeEntries.filter(e => e.id !== entryId);
                loadTodayActivities();
                updateStats();
                showNotification('Entrada eliminada', 'warning');
            }
        }

        function updateStats() {
            // Actualizar estadísticas globales
            const weeklyHours = timeEntries.reduce((sum, entry) => sum + entry.duration, 0);
            const billableHours = timeEntries.filter(e => e.billable).reduce((sum, entry) => sum + entry.duration, 0);
            const efficiency = weeklyHours > 0 ? (billableHours / weeklyHours * 100) : 0;

            document.getElementById('weeklyHours').textContent = weeklyHours.toFixed(1);
            document.getElementById('billableHours').textContent = billableHours.toFixed(1);
            document.getElementById('efficiency').textContent = Math.round(efficiency) + '%';
        }

        // Funciones auxiliares
        function getProjectName(projectKey) {
            const projects = {
                'techstart-mentoring': 'TechStart AI - Mentoría',
                'finflow-dd': 'FinFlow - Due Diligence',
                'ecomart-meeting': 'EcoMart - Reunión Estratégica',
                'portfolio-review': 'Portfolio Review',
                'admin-tasks': 'Tareas Administrativas'
            };
            return projects[projectKey] || projectKey;
        }

        function getClientName(projectKey) {
            const clients = {
                'techstart-mentoring': 'TechStart AI',
                'finflow-dd': 'FinFlow Solutions',
                'ecomart-meeting': 'EcoMart',
                'portfolio-review': 'Interno',
                'admin-tasks': 'Interno'
            };
            return clients[projectKey] || 'Cliente';
        }

        function getProjectType(projectKey) {
            if (projectKey.includes('mentoring')) return 'mentorship';
            if (projectKey.includes('dd')) return 'due-diligence';
            if (projectKey.includes('meeting')) return 'meeting';
            if (projectKey.includes('admin')) return 'admin';
            return 'research';
        }

        function formatDuration(hours) {
            const h = Math.floor(hours);
            const m = Math.round((hours - h) * 60);
            return `${h}h ${m}m`;
        }

        function calculateEndTime(startTime, duration) {
            const [hours, minutes] = startTime.split(':').map(Number);
            const startMinutes = hours * 60 + minutes;
            const endMinutes = startMinutes + (duration * 60);
            const endHours = Math.floor(endMinutes / 60);
            const endMins = endMinutes % 60;
            return `${endHours.toString().padStart(2, '0')}:${Math.round(endMins).toString().padStart(2, '0')}`;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: 'short'
            });
        }

        function getStatusText(status) {
            const statuses = {
                'paid': 'Pagado',
                'pending': 'Pendiente',
                'overdue': 'Vencido'
            };
            return statuses[status] || status;
        }

        // Funciones de facturación
        function generateInvoice() {
            showNotification('Abriendo generador de facturas...', 'info');
        }

        function exportBilling() {
            showNotification('Exportando datos de facturación...', 'info');
        }

        function viewInvoice(invoiceId) {
            showNotification(`Abriendo factura ${invoiceId}...`, 'info');
        }

        function downloadInvoice(invoiceId) {
            showNotification(`Descargando factura ${invoiceId}...`, 'info');
        }

        function markAsPaid(invoiceId) {
            showNotification(`Marcando factura ${invoiceId} como pagada...`, 'success');
        }

        // Funciones de configuración
        function setDefaultHours() {
            showNotification('Aplicando horario estándar de trabajo...', 'info');
        }

        function saveAvailability() {
            showNotification('Guardando configuración de disponibilidad...', 'success');
        }

        // Funciones de exportación
        function exportToday() {
            showNotification('Exportando actividades de hoy...', 'info');
        }

        function changeWeekView(view) {
            showNotification(`Cambiando vista a: ${view}`, 'info');
        }

        function changeAnalyticsPeriod(period) {
            showNotification(`Cambiando período de análisis a: ${period}`, 'info');
        }

        function showNotification(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer') || createToastContainer();
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type === 'info' ? 'primary' : type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            toast.addEventListener('hidden.bs.toast', () => {
                toast.remove();
            });
        }

        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toastContainer';
            container.className = 'toast-container position-fixed top-0 end-0 p-3';
            container.style.zIndex = '9999';
            document.body.appendChild(container);
            return container;
        }
    </script>
</body>
</html>